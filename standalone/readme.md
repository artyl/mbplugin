# Самостоятельно работающая версия

## Вариант работающий на текущем коде

Все это пока глубокая бета для желающих поиграться. Возможно в процессе становления будут какие-то изменения с хранением настроек, но сама база вряд ли поменяется.

## Итак, инструкция по установке

1. Создаем в удобном месте папку mbstandalone (название можете выбрать, какое нравится, это не принципиально)
2. Распаковываем в эту папку содержимое архива (папка mbplugin)
3. Из папки mbplugin\standalone перекладываем файлы в корень папки mbstandalone
4. Запустить ```mbstandalone.bat``` без параметров или с параметром init (при первом запуске он настроит параметры по умолчанию и создаст базу BalanceHistory.sqlite для хранения результатов)
5. Настроить телефоны в phones.ini, в папке mbplugin\standalone уже находится настроенный пример с двумя телефонами
ВАЖНО номера секций ([Phone] #2) не должны повторяться
6. Для проверки корректности ini файлов запустить ```mbstandalone.bat check``` диагностика пока так себе, со временем будем в эту сторону копать
7. Для получения балансов ```mbstandalone.bat getbalance```
8. Если нужно запросить только балансы, по которым были ошибки запустите ```mbstandalone.bat getbalancefailed```
9. Чтобы только обновить balance.html без получения балансов ```mbstandalone.bat updatehtml```
10. Если нужно получить по части балансов запустите ```mbstandalone.bat getbalance filter1 filter2 ...``` будут получены только балансы у которых один из фильтров совпадет с плагином или логином
11. Для настройки автоматической проверки баланса необходимо по какому-то расписанию запускать ```mbstandalone.bat getbalance``` например через системный планировщик ```taskschd.msc```либо как-то еще

## Для инфо

* __В Standalone версии для получения баланса не требуется веб сервер__, веб сервер нужен только для показа информации и обработки команд телеграм ботом. Так что если вы не собираетесь пользоваться телеграм ботом, а балансы смотреть через сгенеренную страничку balance.html с диска то web сервер можно не запускать. Отправка балансов в телеграм через send_tgbalance_onlysend.bat, также работает без веб-сервера.
* Какой оператор указывается в phones.ini (пример файла phones.ini смотрите в папке standalone) в поле Region плагины - это файлы в папке mbplugin\plugin т.е. например для плагина mts файл mts2.py, а в поле нужно будет указать ```Region=p_mts2``` т.е. с префиксом p_ и без расширения
* На текущий момент доступен только просмотр веб страницы с балансом [http://localhost:19777/report](http://localhost:19777/report), открыть его можно, выбрав Open report через иконку веб-сервера в системном трее, либо без веб-сервера можно открыть balance.html в корневой папке standalone версии
* Для просмотра истории по балансу установите параметр RealAverageDays=число дней просмотра истории. Помните, что чем больше дней, тем дольше строится страница с балансом.
* Все данные по балансам хранятся в файле BalanceHistory.sqlite в корне проекта, это база данных sqlite при желании можно поработать с ней из других программ для построения какой-то аналитики.
* При желании можно настроить телеграм бота так же как для обычной версии, но только по варианту 2 (tg_from = sqlite, см общий readme раздел Телеграм бот вариант 2 (получаем балансы из sqlite))
* При желании можно запустить несколько mbplugin одновременно из разных папок на разных портах, но возможны коллизии при управлении хромом, когда несколько разных плагинов попытаются запускать их одновременно

## Текущие проблемы

Слабая диагностика ошибок в phones.ini, который пока правится руками.

## Дальнейшее развитие

* Запросить неудачные попытки
* В дальнейшем это частично переедет в веб-сервер, где будет шедулер и подобный функционал.
