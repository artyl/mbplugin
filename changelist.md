## mbplugin 0.99.01 (02.06.20) Первая публичная бета

## mbplugin 0.99.02 (07.06.20) Сборка от 07.06.2020
Новые плагины
usd - Курс доллара с RBC
eur - Курс евро с RBC
financeyahoo - Курс ценных бумаг с finance.yahoo.com
moex - Курс ценных бумаг с moex.com
stock - Рассчет цены портфеля ценных бумаг
sipnet - Sipnet (IP телефония)

## mbplugin 0.99.03 (08.06.20) fix avtodor-tr.py
avtodor-tr - Автодор транспондер

## mbplugin 0.99.04 (09.06.20) Relative path 

## mbplugin 0.99.05 (16.06.20) jsmb localhost plugin
Самое важное изменение - это jsmb плагины через локальный web server (см readme.md)
1. Теперь mbplugin не привязан к папке c:\mbplugin а может быть установлен в любую папку, приоритетный вариант - распаковать содержимое в папку где лежит MobileBalance, важно помнить, что при перемещении mbplugin в другую папку необходимо пересобрать dll плагины (это несложно, всего лишь запустить mbplugin\dllsource\compile_all_p.bat, но без этого работать не будет)
2. Добавлен режим работы через webserver и jsmb плагин, работающий через этот webserver - несмотря на недостаток, в виде большей зависимости от IE, этот вариант дает прикольную плюшку в виде того, что гораздо больше полей из результата попадают в mobilebalance, из наиболее заметного - это список услуг и количество SMS (в этом смысле немного печалит, что мозговой штурм на DLL плагины оказался немного напрасным, т.е. кроме опыта дебагинга DLL от него практической позьзы получаетяс немного). Посмотрим, если вариант jsmbLH плагины себя хорошо покажут, то объявим это т вариант майнстримом.
3. Добавлен режим сохранения запросов через mbplugin в базу sqlite и построением результата в виде html странички.
4. Теперь настройки лежат в файле mbplugin.ini, если вы распаковали mbplugin в папку с mobilebalance, то после запуски mbplugin\setup_and_check.bat ищите mbplugin.ini в папке где лежит mobilebalance.
5. В перспективе я расчитываю, что mbplugin перенесет в себя основной функционал MobileBalance и станет самостоятельным приложением, ближайшие планы - импорт данный из mdb базы MobileBalance и собственное расписание запросов. Размышляю над собственной реализацией jsmb плагинов, но пока не придумал как это можно реализовать. Также хочу отметить, что против опсосов у нас богатый арсенал - selenium, headless chrome, ML и много чего интересного.
Подробное описание в readme.md, исправления приветсвуются в виде pull request в github, если с этим сложности - пишите в понятном вам варианте, оптимальный вариант замечаний - такой, который я смогу у себя повторить - такие имеют шанс быть обработаны максимально быстро.

## mbplugin 0.99.06 (18.06.20) add UslugiOn to tele2 and beeline and fix web server

## mbplugin 0.99.07 (25.06.20) jsmb localhost plugin installer

## mbplugin 0.99.08 (28.06.20) danycom provider
Наконец приехала симка Danycom. Встречайте - новая версия MBplugin с поддержкой Danycom так же много кого еще (у меня все операторы работают через mbplugin, стабильность работы MobileBalance поразительная) 

## mbplugin 0.99.09 (05.07.20) Add yota and onlime
В версии
* Новые плагины yota и onlime
* Исправлена проблема с русскими буквами и спецсимволами в пароле
* Для групповых тарифов МТС сделана возможность переключить просмотр остатков интернета и СМС / использовано интернета и СМС;

## mbplugin 0.99.10 (09.07.20) Telegram bot
В этой версии
* Телеграм бот

## mbplugin 0.99.11 (10.07.20) Telegram bot over MobileBalance web server
Сегодня подумал и сделал еще один вариант бота (версия 0.99.11)
В этом варианте бот берет данные непосредственно из MobileBalance, так что в боте будут все балансы которые есть в MobileBalance, без дополнительных усилий.
Т.е. вы можете все данные получать обычными плагинами, и видеть их в телеграм боте настроенном через второй вариант бота.
Как обычно версия mbplugin лежит (ссылку на дистрибутив ищите в шапке)
В этой версии
* ДВА варианта Телеграм бота

## mbplugin 0.99.12 (19.07.20) Small change
В этой версии только небольшие изменения
* исправления Danycom (иногда не возвращал значения)
* исправления parking_mos (не удерживал сессию, из-за чего начинали приходить в почту уведомления о заходе в личный кабинет с нового устройства)
* добавил в TG бота выдачу на сколько изменился баланс с прошлого запроса, это можно было и раньше сделать руками через ini, просто я сделал такой вариант по умолчанию (для того чтобы заработало нужно перезапустить вебсервер)

## mbplugin 0.99.14 (12.08.20) mts2 plugin on puppeteer
В этой версии альтернативный плагин для mts - mts2, который открывает браузер и получает баланс через него.
Плагин экспериментальный, поэтому не исключено что с ним могут возникнуть проблемы (у меня на 10+ МТС номеров работает нормально)
Если у вас предыдущая версия mbplugin.0.99.12 то можете обновить только содержимое папки plugin, если более старая, то обновляйте еще папку python или всю папку mbplugin целиком.
После обновления обязательно запустите setup_and_check.bat
После обновления можно файлом mts2.py заменить файл mts.py, и тогда все телефоны МТС будут обновляться новым плагином, либо подключить mts2 и поменять его в настройках телефона в mobilebalance как новый плагин.
* MTS2 - новый плагин для mts через открытие браузера (через puppeteer)

## mbplugin 0.99.15 (17.08.20) show and hide puppeteer
* Главное - научился запускать хром скрытым окном (при запуске на долю секунды появляется в трее окно хрома, но это уже точно не лечиться)
    * Окно с хромом показывается всегда в DEBUG режиме (logginglevel = DEBUG) или можно включить в ini show_chrome = 1
    * Также можно в любой момент сделать окно хрома видимым запустив mbplugin\plugin\show_chrome.bat
* Можно смотреть лог mbplugin через браузер (http://localhost:19777/log?lines=40) также можно открыть через иконку в трее
* Добавил по просьбе dimon_s2020 возможность скрыть иконку в трее (в mbplugin.ini в разделе Options добавить show_tray_icon=0)
* Если в процессе обнаруживается капча, то окно браузера делается видимым и минуту ожидается ввод капчи
* У меня есть МТС симка, которая находится не у меня и нет возможности поменять на ней пароль, но она привязана в личном кабинете к моей.
    * MTS2 умеет заходить в ЛК на один номер и забирать баланс с привязанного к нему номера, для этого в поле логин номер пишем в виде 9161234567/9177654321 где 
        * 9161234567 это номер от которого получаем баланс
        * 9177654321 это номер в ЛК которого заходим и пароль соответственно указываем от него
    * У меня вроде работает, но решение спорное, если кому-то такое нужно попробуйте.
* Плагин для ростелеком (https://lk.rt.ru) если у вас в личном кабинете как у меня несколько лицевых счетов, то можно указать логин/лицевой_счет, если один то можно просто указать логин
+ Код MTS2 пока выглядит ужасно - это такой франкенштейн из моих экспериментов, устаканится - тогда облагорожу, ростелеком уже написан более аккуратно, так что если соберетесь делать что-то свое за основу есть смысл брать ростелеком.

## mbplugin 0.99.16 (17.08.20) show and hide puppeteer
Исправил установку с нуля (в прошлой 14й версии умудрился ее сломать)
Починил фантомные окна (теперь не должны появляться) а также исправвил по настройкам показывать/не показывать Chrome

## mbplugin 0.99.17 (25.08.20) fix Unknown in tg bot
Исправил выдачу информации в Телеграм боте (лишние строчки с Unknown).
Убрал из сборки не работающий плагин mts (для МТС используйте плагин mts2)

## mbplugin 0.99.18 (30.08.20) add proxy for tg bot and subscription
Много изменений по коду обновлять всю папку plugin целиком  
Добавил возможность работы телеграм бота через проки  
Добавил подписки для бота - возможность отправлять информацию по указаным фильтрам номеров

## mbplugin 0.99.19 (03.09.20) fix mts2
Исправлена работа провайдера для MTS (двухэтапное окно логина, сначала логин, потом пароль)  
Добавлены дополнительные настройки для телеграм подписок, например можно указать send_empty:0 индивидуально для каждой подписки  
Много изменений по коду обновлять всю папку plugin целиком

## mbplugin 0.99.20 (14.09.20) add a1.by
Небольшие правки в модуле по работе с puppeteer  
Добавлен тестовый плагин test3 для тестирования puppeteer chrome (Его так же можно брать за основу)  
Добавлен оператор a1.by (сотовая связь Беларусь) Автор плагина Exemok  

## mbplugin 0.99.21 (24.09.20) Standalone version
В этой версии появилась возможность использовать mbplugin самостоятельно без mobilebalance, естественно возможен запуск только плагинов из mobilebalance  
Новый плагин mosenergosbyt для использования в поле логина пишите логин/лицевой_счет  
Новый плагин vscale (Облачные серверы для разработчиков), сделан больше для демонстрации новых возможностей.  
Новый плагин currency заменил собой плагины eur, usd, moex и yahoo, для курса валют с сайта ЦБ пишите в поле логин код валюты USD, EUR и т.п. 
Если хотите курсы c RBC пишите в логине RBC_USD, если хотите котировки  валют с сайта биржи MOEX пишите MOEX_USD/RUB, Хотите котировки ценных бумаг MOEX_TATNP,
Хотите котировки с сайта finence.yahoo.com пишите YAHOO_AAPL  
Выкинул из сборки содержимое папки python\scripts, для работы mbplugin оно все равно не требуется, а обновляемся мы все равно через замену папки, а уж коли на него иногда антивирус срабатывает, то лучше его убрать чтобы вопросов было меньше  
И наконец самое главное, но видимое только авторам плагинов. Писать плагины для движка хрома стало на порядок легче, код переработанных плагинов можно посмотреть в плагинах (test4, rostelecom, vscale, mosenergosbyt)  

## mbplugin 0.99.22 (12.10.20) Small fix (faster and more stable, balance request over telegram for standalone version)
Важно! В целях унификации заход в ЛК МТС через другой номер теперь пишем сначала номер в который логинимся/номер баланс которого хотим посмотреть (чтобы мтс, ростелеком и мосэнергосбыт схема была одинаковая)  
В плагинах ростелеком и мосэнергосбыт в случае одного лицевого счета в ЛК можно не указывать лицевой счет в логине  
В плагинах через хром подправлен механизм логина, чтобы он в случае неуспеха не ломился по многу раз.  
Скорость работы плагинов на хроме увеличилась, у МТС примерно в 2-3 раза.  
Как показала практика, для плагинов через хром включение логгирования DEBUG приводит к огромному количеству записей от самого движка puppeteer, и ряда библиотек, исправлено.  
Добавил параметры для разборок плагинов через хром - log_responses=1 - запишет все просмотренные страницы, также не забывайте про show_chrome=1 они дадут достаточно понятную информацию  
__Автономная версия__:
Теперь можно запрашивать балансы командой /receivebalance, без параметров - все телефоны, либо после через пробел какие балансы получить (как призапуске из батника mbstandalone.bat GETBALANCE). Естественно такая возможность, как и просмотр баланса доступна только если id вашего телеграма прописан в ini в строчке auth_id
В случае если низкий баланс, скорое время отключения либо баланс давно не менялся в боте напротив номера появляется соответстующий коментарий
Фильтр получаемых номеров в запросе в автономной версии добавлен Alias. Также можно не писать логин/алиас/оператор а можно его часть
В случае ошибки останавливалось получение балансов. Исправлено.  
Рекомендую заглянуть в settings.py там описаны все параметры ini файла с коментариями.  
Если setup_and_check.bat запустить с параметром noweb то он не дабавляет запуск webserver в автозапуск  
Аналогично mbstandalone.bat init noweb - также не добавляет web сервер в автозапуск.

## mbplugin 0.99.23 (16.10.20) Mts obshchiy_paket, standalone version addition parameter
Плагин mts2 умеет забирать информацию из общего пакета для телефонов указанных в параметре mts_usedbyme, или по всем телефонам если mts_usedbyme=1  
Можно показывать остаток по общему пакету МТС, а не по телефону если в поле номера телефона указать 9161234567/common, или общий расход пакета 9161234567/common_rest  
В автономной версии теперь можно прописывать параметры BalanceNotChangedMoreThen, BalanceChangedLessThen, BalanceLessThen, TurnOffLessThen для каждого телефона (пример см standalone\phones.ini)  

## mbplugin 0.99.24 (28.10.20) Tele2 sms, MTS captcha show, yota chrome, browser chromium support
Добавил в tele2 информацию по SMS (при участии 2350040)  
Вынес параметр interUnit (еденицы измерения для инета) в ini. По умолчанию GB. Пока это включено для mts и tele2  
Для плагинов через хром можно задать прокси сервер в формате http://user:pass@12.23.34.56:6789  
Для плагинов через хром добавлена возможность показа хрома в случае появления капчи (при участии comr)  
Для плагинов через хром улучшена обработка ошибок при неожиданном закрытии хрома  
Очередная попытка починить плагин mosenergosbyt для ряда случаев (при участии dimon_s2020)  
Для плагинов через хром исправлена работа с другими браузерами на движке cromium (edge, yandex, brave и т.п., опера хоть и на хромиуме но нормально не заработала)  
Плагин yota теперь тоже через хром  

## mbplugin 0.99.25 (28.10.20) Fix bug show captcha
Исправление ошибки показа браузера (багрепорт comr)  

## mbplugin 0.99.26 (03.11.20) Show history for standalone version 
В этой версии изменения коснулись только Standalone версии.  
В standalone версии можно включить показ истории по балансу (RealAverageDays=30), все остальные тонкие настройки см как обычно в settings.py  
Помните, что чем больше дней, тем дольше строится страница с балансом  

## mbplugin 0.99.27 (12.12.20) Fix onlime 
В плагине mts2 добавлено получение баланса кэшбэка в переменную Balance2  
Исправлена работа провайдера Onlime (my.rt.ru ростелеком Москва) - теперь он тоже на хроме  
Плагин stock теперь может забирать цену ETF(фонды) с moex.com  
Плагин stock может сохранять детальный лог по ценным бумагам чтобы по нему строить развернутую аналитику (для подготовки аналитики из лога скрипт make_stock_stat.py)  
Fix. В плагине megafon были проблемы когда имя было с кавычками (так бывает когда телефон на организацию)  
a1by добавлено закрытие баннера  

## mbplugin 0.99.28 (12.12.20) Fix2 onlime 
В процессе тестирования у нового плагина OnLime для mbplugin выявлен странный глюк - он работал только при включенном показе хрома. Вроде исправил.  

## mbplugin 0.99.29 (22.12.20) Standalone mix mode. New tg bot feature. Fix onlime.
Большие улучшения по автономной версии.
Добавлена команда в TG бота /getone - по ней выдается список всех балансов с выбором какой баланс показать + список услуг  
Добавлена команда в TG бота /checkone - то же что и getone но в дополнение если известен пароль пытается запросить баланс  
Также по getone и checkone по номеру выдается информация о тарифе, сроке отключения и т.п. все что в строчке обычно показывается  
Добавлена команда в TG бота /restart - перезапуск службы веб сервиса и http сервера.  
Работу автономной standalone версии и обычной версии можно совместить. Теперь пароль для автономной версии можно задать не только в phones.ini но и в phones_add.ini (ключи заданые в phones_add.ini имеют больший приоритет чем в phones.ini что позволяет использовать возможности standalone версии при использовании mobilebalance - проблема была в том что mobilebalance перезатирает не свои ключи в phones.ini таким образом можно задать пароль в phones_add.ini)  
Добавлено выделение цветом запросов по которым были ошибки и запросы которые в очереди  
При наведении на колонку услуги - показывает список подключенных услуг (всплывающим окном, также как с историей по балансу)  
Плагин stock правки по получению котировок, также выгрузка статистики в файл, но похоже кроме меня им никто не пользуется, так что изменений много, если кому что нужно объяснить - пишите  
Плагин parking_mos в связи с его поломкой переписан на движок хрома. В процессе отладки он перестал меня заваливать SMS так что я не уверен что показ окна с SMS работает как с капчей, но если возникнут проблемы с первым входом, то есть смысл включить настройку show_chrome=1 или после запуска запроса баланса запустить show_chrome.bat  
Плагин Sodexo теперь умеет сохранять список транзакций и показывать его в balance.html  
Починил onlime - он перестал забирать баланс  
Починил mts2 на предмет корректного показа минут и трафика в общих пакетах  

## mbplugin 0.99.30 (15.04.21) Lovit, chrome banner, fix yota, standalone minor improvements, chrome 90 path fix.
В standalone версии добавлена команда getbalancefailed - запросить только неудачные попытки  
В TG бота добавлены к команде receivebalance - запрос всех балансов receivebalancefailed по аналогии с mbstandalone.bat  
В меню на Tray Icon добавлена команда Restart server  
В меню на Tray Icon добавлена команда Recompile jsmblh plugin - пересобрать плагины, теперь не нужно для этого запускать setup_and_check.bat  
В меню на Tray Icon добавлена команда начать новый лог (Flush log) - старый лог переименовывается в файл с текущей датой и его можно удалить  
Улучшена диагностика при ошибках плагина  
Добавил логирования для обычных не хром плагинов сохраняю json как в плагинах для хрома  
Возможно поборол проблему с остатками интернета для билайна  
Добавлен оператор lovit (lovit.ru) (интернет и телевидение)  
Добавлен оператор b2b.megafon.ru (корпоративный мегафон)  
Убрал баннер Работа Chrome была завершена некорректно  
Исправлена работа оператора yota  
Добавлена команда restart в httpserver_mobile  
Добавлены тесты pytest, плагины переписаны под работу тестов, с сохранением совместимости со старой версией  
В экспериментальном режиме добавлено редактирование mbplugin.ini (чтобы включить - добавить httpconfigedit=1) в варианте по умолчанию с локальной машины без пароля с удаленной требуется задать пароль  
BUGFIX: В хроме 90 перестал воспринимать относительный путь к папке профилей, исправлено  

## mbplugin 0.99.31 (23.04.21) Zero install bugfix
BUGFIX: При установке с нуля и отсутствии файла mbplugin.ini программа уходила в рекурсию.  
Плагин beeline_uz.py Билайн Узбекистан  

## mbplugin 0.99.32 (23.04.21) Актуализация
FIX: beeline.py - перестал получать баланс (поменялось API)  
uminet.py - новый провайдер  
mts2.py - добавлена проверка при входе через МТС (пропускаем окно с предложением зайти в ЛХ этого телефона)  
